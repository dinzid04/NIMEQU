extends layout

block content
  div(class="container mx-auto px-4 sm:px-6 lg:px-8 py-8")
    //- New Hero Section
    section(class="mb-12 animate-fade-in")
      div(class="relative bg-gray-900 rounded-2xl overflow-hidden p-8 md:p-12 border border-gray-800")
        div(class="absolute inset-0 bg-gradient-to-br from-primary-900/40 to-primary-600/20 opacity-50")
        div(class="absolute -bottom-16 -right-16 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl")
        div(class="relative z-10")
          h1(class="text-4xl md:text-5xl font-extrabold text-white mb-4 leading-tight")
            | Temukan Dunia Anime
            br
            span(class="text-primary-400") Di Ujung Jari Anda
          p(class="text-lg text-gray-300 max-w-2xl")
            | Jelajahi ribuan judul anime dari berbagai genre. Ongoing, Complete, Movie, semuanya ada di sini dengan kualitas terbaik dan subtitle Indonesia.

    //- Main content grid
    div(class="grid grid-cols-1 xl:grid-cols-4 gap-8")
      //- Main column for anime lists
      div(class="xl:col-span-4")
        //- Ongoing Anime Section
        if ongoingAnime && ongoingAnime.length > 0
          section(class="mb-12 animate-slide-up" style="animation-delay: 100ms;")
            div(class="flex items-center justify-between mb-6")
              h2(class="text-2xl md:text-3xl font-bold text-white") Sedang Tayang
              a(href="/ongoing" class="text-sm font-medium text-primary-400 hover:text-primary-300 flex items-center gap-1 transition-colors")
                span Lihat Semua
                svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"): path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5-5 5")
            
            div(class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6")
              each anime in ongoingAnime.slice(0, 12)
                div(class="group perspective-1000")
                  a(href=`/anime/${anime.slug}` class="block transform-style-3d transition-transform duration-500 group-hover:-translate-y-2 group-hover:rotate-x-3")
                    div(class="relative aspect-[2/3] bg-gray-800 rounded-xl shadow-lg group-hover:shadow-2xl group-hover:shadow-primary-900/50 overflow-hidden transform-style-3d transition-all duration-500 group-hover-glow")
                      img(src=anime.poster alt=anime.title class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=Error';")
                      div(class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent")
                      div(class="absolute inset-0 flex flex-col justify-end p-4")
                        h3(class="font-bold text-sm text-white line-clamp-2 leading-tight")= anime.title
                        if anime.current_episode
                          p(class="text-xs text-primary-300 font-medium mt-1")= anime.current_episode
                      if anime.release_day
                        div(class="absolute top-2 right-2 bg-black/50 backdrop-blur-sm text-white text-xs font-semibold px-2 py-1 rounded-md")= anime.release_day

        //- Complete Anime Section
        if completeAnime && completeAnime.length > 0
          section(class="mb-12 animate-slide-up" style="animation-delay: 200ms;")
            div(class="flex items-center justify-between mb-6")
              h2(class="text-2xl md:text-3xl font-bold text-white") Anime Tamat
              a(href="/complete" class="text-sm font-medium text-primary-400 hover:text-primary-300 flex items-center gap-1 transition-colors")
                span Lihat Semua
                svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"): path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5-5 5")
            
            div(class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6")
              each anime in completeAnime.slice(0, 12)
                div(class="group perspective-1000")
                  a(href=`/anime/${anime.slug}` class="block transform-style-3d transition-transform duration-500 group-hover:-translate-y-2 group-hover:rotate-x-3")
                    div(class="relative aspect-[2/3] bg-gray-800 rounded-xl shadow-lg group-hover:shadow-2xl group-hover:shadow-primary-900/50 overflow-hidden transform-style-3d transition-all duration-500 group-hover-glow")
                      img(src=anime.poster alt=anime.title class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=Error';")
                      div(class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent")
                      div(class="absolute inset-0 flex flex-col justify-end p-4")
                        h3(class="font-bold text-sm text-white line-clamp-2 leading-tight")= anime.title
                        if anime.rating
                          div(class="flex items-center gap-1 mt-1")
                            svg(class="w-3 h-3 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"): path(d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z")
                            p(class="text-xs text-gray-300 font-medium")= anime.rating
                      div(class="absolute top-2 left-2 bg-green-500/80 backdrop-blur-sm text-white text-xs font-bold px-2 py-1 rounded-md") Complete

        //- Ads
        if adSlots && adSlots.contentBottom && adSlots.contentBottom.length > 0
          section(class="my-8 animate-slide-up" style="animation-delay: 300ms;")
            each ad in adSlots.contentBottom
              div(class="ad-slot bg-gray-800 rounded-xl shadow-lg")!= ad.content

      //- Sidebar (can be repurposed or kept for ads/other content)
      //- For now, I've removed the explicit sidebar to give more focus to the content.
      //- You can add a sidebar column back here if needed.

block scripts
  //- Add custom styles for 3D perspective if needed
  style.
    .perspective-1000 { perspective: 1000px; }
    .transform-style-3d { transform-style: preserve-3d; }
    .rotate-x-3 { transform: rotateX(3deg); }

  //- Scripts for QR code and donation form
  script.
    const qrcode = !{JSON.stringify(qrcode || null)};
    if(qrcode){
      new QRCode(document.getElementById('qrcode'), {
        text: qrcode,
        width: 180,
        height: 180,
        colorDark: "#ffffff",
        colorLight: "#1e293b" // Dark background for QR code
      })
    }

    const donasiForm = document.getElementById('donasi');
    donasiForm?.addEventListener("submit", function (e) {
      const nominal = document.getElementById('nominal');
      if(nominal && nominal.value < 1000){
        nominal.value = 1000;
      }
    });

    // Lazy loading for images
    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            const src = img.getAttribute('data-src');
            if (src) {
              img.src = src;
              img.removeAttribute('data-src');
            }
            imageObserver.unobserve(img);
          }
        });
      }, { rootMargin: '0px 0px 200px 0px' }); // Load images 200px before they enter viewport

      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }