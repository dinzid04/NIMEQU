doctype html
html(lang="id" class="scroll-smooth")
  head
    //- Meta tags (kept mostly the same for SEO)
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title= title || "KitaNime - Streaming Anime Subtitle Indonesia"
    meta(name="description" content=description || "Nonton anime subtitle Indonesia terlengkap dan terbaru")
    meta(name="keywords" content="kitanime, KitaNime, anime, streaming anime, subtitle indonesia, nonton anime, anime sub indo, anime indonesia, streaming anime gratis, anime terbaru, anime ongoing, anime complete, anime movie, download anime, watch anime online, anime HD, otaku indonesia, Streaming Anime Sub Indo, streaming anime, sub indo, sub indonesia")
    meta(name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1")
    meta(name="google-site-verification" content="KYZb3rNH5REPdVtPCSei_EhvxVJDmX7zd1KVWn49M_k")
    meta(name="language" content="Indonesian")
    meta(http-equiv="content-language" content="id-ID")
    meta(name="author" content="IkuzaDev")
    meta(name="publisher" content="D5studioID")
    meta(name="copyright" content="© 2025 KitaNime. All rights reserved.")
    meta(name="google-adsense-account" content="ca-pub-7452678962186302")
    link(rel="icon" href="/images/favicon.ico" onerror="this.onerror=null;this.src='https://placehold.co/400';")
    link(rel="canonical" href="https://d5studio.my.id")
    link(rel="alternate" hreflang="id" href=`https://d5studio.my.id${url || '/'}`)
    link(rel="icon" type="image/x-icon" href="/images/favicon.ico")
    link(rel="apple-touch-icon" sizes="180x180" href="/images/logo.png")
    meta(name="theme-color" content="#7c3aed")
    
    //- OG and Twitter meta (kept the same)
    meta(property="og:title" content=title)
    meta(property="og:description" content=description)
    meta(property="og:type" content="website")
    meta(property="og:url" content="https://d5studio.my.id")
    meta(property="og:site_name" content="KitaNime")
    meta(property="og:image" content="https://d5studio.my.id/images/logo.png")
    meta(name="twitter:card" content="summary_large_image")
    meta(name="twitter:title" content=title)
    meta(name="twitter:description" content=description)
    meta(name="twitter:image" content="https://d5studio.my.id/images/logo.png")

    //- Preconnects
    link(rel="preconnect" href="https://fonts.googleapis.com")
    link(rel="preconnect" href="https://fonts.gstatic.com" crossorigin)
    
    //- Tailwind CSS and other libraries
    script(src="https://cdn.tailwindcss.com/3.4.17")
    script.
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 300: '#c4b5fd', 400: '#a78bfa', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9', 800: '#5b21b6', 900: '#4c1d95', 950: '#2e1065'
              },
              gray: {
                50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a', 950: '#020617'
              }
            },
            fontFamily: {
              'sans': ['Inter', 'system-ui', 'sans-serif']
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-out forwards',
              'slide-up': 'slideUp 0.5s ease-out forwards',
            },
            keyframes: {
              fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
              slideUp: { '0%': { transform: 'translateY(20px)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } },
            }
          }
        }
      }

    //- Custom Styles
    style.
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
      body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      .search-suggestions { max-height: 300px; overflow-y: auto; }
      .ad-slot { min-height: 50px; display: flex; align-items: center; justify-content: center; }
      .nav-link-active { color: #c4b5fd !important; background-color: rgba(196, 181, 253, 0.1); }
      .group:hover .group-hover-glow {
        box-shadow: 0 0 15px rgba(167, 139, 250, 0.4);
      }
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background-color: #1f2937;
        display: flex;
        justify-content: space-around;
        align-items: center;
        z-index: 1000;
      }
      .bottom-nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #d1d5db;
        font-size: 12px;
      }
      .bottom-nav-item.active {
        color: #c4b5fd;
      }

  body(class="bg-gray-950 text-gray-200 font-sans transition-colors duration-300")
    //- Header
    header(class="sticky top-0 z-50 bg-gray-950/70 dark:bg-gray-950/70 backdrop-blur-lg border-b border-gray-800/50 transition-colors duration-300")
      nav(class="container mx-auto px-4 sm:px-6 lg:px-8")
        div(class="flex items-center justify-between h-16")
          //- Logo
          a(href="/" class="flex items-center gap-2")
            img(src="/images/logo.png" alt="KitaNime" class="h-8 w-auto rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/400?text=KN';")
            span(class="text-xl font-bold text-white hidden sm:block") ANIMAQU

          //- Desktop Navigation
          div(class="hidden md:flex items-center space-x-2")
            a(href="/" class=`px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'home' ? 'nav-link-active' : ''}`) Beranda
            a(href="/ongoing" class=`px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'ongoing' ? 'nav-link-active' : ''}`) Ongoing
            a(href="/complete" class=`px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'complete' ? 'nav-link-active' : ''}`) Complete
            a(href="/genres" class=`px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'genres' ? 'nav-link-active' : ''}`) Genre
            a(href="/comic" class=`px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'comic' ? 'nav-link-active' : ''}`) Comic

          //- Search and Theme Toggle
          div(class="flex items-center gap-4")
            //- Search
            div(class="flex-1 max-w-xs relative")
              form(action="/search" method="GET" class="relative")
                input(type="text" name="q" placeholder="Cari anime..." value=keyword || "" class="w-full px-4 py-2 pl-10 pr-4 border-0 rounded-lg bg-gray-800 text-gray-200 placeholder-gray-500 focus:ring-2 focus:ring-primary-500 focus:bg-gray-900 transition-all duration-200" autocomplete="off" id="searchInput")
                button(type="submit" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500")
                  svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"): path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z")
              div(id="searchSuggestions" class="absolute top-full left-0 right-0 bg-gray-900 border border-gray-800 rounded-lg shadow-lg mt-1 hidden search-suggestions z-50")
            
            //- Theme Toggle
            button(id="darkModeToggle" class="p-2 rounded-lg text-gray-400 hover:bg-gray-800 hover:text-white transition-colors")
              svg(id="sunIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"): path(fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd")
              svg(id="moonIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"): path(d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z")

            //- Mobile Menu Button
            button(id="mobileMenuBtn" class="md:hidden p-2 text-gray-400 hover:text-white")
              svg(class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"): path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16")
        
        //- Mobile Menu
        div(id="mobileMenu" class="md:hidden hidden pb-4")
          div(class="flex flex-col space-y-2 pt-2")
            a(href="/" class=`block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'home' ? 'nav-link-active' : ''}`) Beranda
            a(href="/ongoing" class=`block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'ongoing' ? 'nav-link-active' : ''}`) Ongoing
            a(href="/complete" class=`block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'complete' ? 'nav-link-active' : ''}`) Complete
            a(href="/genres" class=`block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'genres' ? 'nav-link-active' : ''}`) Genre
            a(href="/comic" class=`block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-all ${currentPage === 'comic' ? 'nav-link-active' : ''}`) Comic

    //- Ads
    if adSlots && adSlots.header && adSlots.header.length > 0
      div(class="container mx-auto px-4 py-2")
        each ad in adSlots.header
          div(class="ad-slot bg-gray-800 rounded-lg")!= ad.content

    //- Main Content
    main(class="min-h-screen")
      block content

    //- Bottom Navigation for Mobile
    div(class="bottom-nav md:hidden")
      a(href="/" class=`bottom-nav-item ${currentPage === 'home' ? 'active' : ''}`)
        span Beranda
      a(href="/ongoing" class=`bottom-nav-item ${currentPage === 'ongoing' ? 'active' : ''}`)
        span Ongoing
      a(href="/complete" class=`bottom-nav-item ${currentPage === 'complete' ? 'active' : ''}`)
        span Complete
      a(href="/genres" class=`bottom-nav-item ${currentPage === 'genres' ? 'active' : ''}`)
        span Genre
      a(href="/comic" class=`bottom-nav-item ${currentPage === 'comic' ? 'active' : ''}`)
        span Comic

    //- Footer
    footer(class="bg-gray-900 border-t border-gray-800 mt-16")
      div(class="container mx-auto px-4 sm:px-6 lg:px-8 py-12")
        div(class="grid grid-cols-1 md:grid-cols-10 gap-8")
          //- Brand and About
          div(class="md:col-span-4")
            div(class="flex items-center space-x-2 mb-4")
              img(src="/images/logo.png" alt="KitaNime" class="h-8 w-auto rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/400?text=KN';")
              span(class="text-xl font-bold text-white") KitaNime
            p(class="text-gray-400 text-sm") Platform streaming anime subtitle Indonesia terlengkap dan terbaru. Nikmati ribuan anime berkualitas tinggi.

          //- Quick Links
          div(class="md:col-span-2")
            h3(class="text-sm font-semibold text-gray-300 tracking-wider uppercase") Navigasi
            ul(class="mt-4 space-y-2")
              li: a(href="/ongoing" class="text-sm text-gray-400 hover:text-white transition-colors") Ongoing
              li: a(href="/complete" class="text-sm text-gray-400 hover:text-white transition-colors") Complete
              li: a(href="/movies" class="text-sm text-gray-400 hover:text-white transition-colors") Movies
              li: a(href="/genres" class="text-sm text-gray-400 hover:text-white transition-colors") Genre

          //- Legal
          div(class="md:col-span-2")
            h3(class="text-sm font-semibold text-gray-300 tracking-wider uppercase") Legal
            ul(class="mt-4 space-y-2")
              li: a(href="/dmca" class="text-sm text-gray-400 hover:text-white transition-colors") DMCA
              li: a(href="/privacy-policy" class="text-sm text-gray-400 hover:text-white transition-colors") Privacy Policy

          //- Social
          div(class="md:col-span-2")
            h3(class="text-sm font-semibold text-gray-300 tracking-wider uppercase") Ikuti Kami
            div(class="flex space-x-4 mt-4")
              a(href="#" class="text-gray-400 hover:text-white transition-colors"): svg(class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"): path(d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z")
              a(href="#" class="text-gray-400 hover:text-white transition-colors"): svg(class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"): path(d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.585-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.585-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.585.069-4.85c.149-3.225 1.664-4.771 4.919-4.919 1.266-.057 1.644-.069 4.85-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.667-.014 4.947-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.947s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.689-.073-4.948-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.441 1.441 1.441 1.441-.646 1.441-1.441-.645-1.44-1.441-1.44z")

        div(class="mt-8 pt-8 border-t border-gray-800 text-center text-sm text-gray-500")
          p © #{new Date().getFullYear()} KitaNime. All Rights Reserved.
          p(class="mt-1") Dibuat dengan ❤️ untuk para pecinta anime.

    //- Cookie Consent
    if showCookieConsent
      div(id="cookieConsent" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-md bg-gray-800/80 backdrop-blur-sm border border-gray-700 rounded-lg shadow-2xl p-4 z-[100] animate-fade-in")
        div(class="flex items-start space-x-3")
          div(class="flex-shrink-0"): svg(class="w-5 h-5 text-primary-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"): path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
          div(class="flex-1")
            p(class="text-sm text-gray-300 mb-3") Website ini menggunakan cookie untuk meningkatkan pengalaman Anda.
            div(class="flex space-x-2")
              button(id="acceptCookies" class="px-3 py-1 bg-primary-600 text-white text-sm rounded-md hover:bg-primary-700 transition-colors") Terima
              button(id="declineCookies" class="px-3 py-1 bg-gray-700 text-gray-200 text-sm rounded-md hover:bg-gray-600 transition-colors") Tolak

    //- Scripts
    if currentPage === 'comic'
      link(rel="stylesheet", href="/css/comic.css")
    script(src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js")
    script(src='https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js')
    script.
      // Dark/Light Mode Logic
      const darkModeToggle = document.getElementById('darkModeToggle');
      const sunIcon = document.getElementById('sunIcon');
      const moonIcon = document.getElementById('moonIcon');
      const html = document.documentElement;

      const applyTheme = (theme) => {
        if (theme === 'dark') {
          html.classList.add('dark');
          sunIcon.classList.remove('hidden');
          moonIcon.classList.add('hidden');
        } else {
          html.classList.remove('dark');
          sunIcon.classList.add('hidden');
          moonIcon.classList.remove('hidden');
        }
      };

      const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark
      applyTheme(savedTheme);

      darkModeToggle?.addEventListener('click', function() {
        const newTheme = html.classList.contains('dark') ? 'light' : 'dark';
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);

        // This is a simple trick to force tailwind to re-evaluate dark classes on other pages
        document.body.className = document.body.className.replace(/bg-gray-\d+/, newTheme === 'dark' ? 'bg-gray-950' : 'bg-gray-50');
      });

      // Mobile Menu Logic
      document.getElementById('mobileMenuBtn')?.addEventListener('click', function() {
        document.getElementById('mobileMenu').classList.toggle('hidden');
      });

      // Search Suggestions Logic
      const searchInput = document.getElementById('searchInput');
      const searchSuggestions = document.getElementById('searchSuggestions');
      let searchTimeout;

      searchInput?.addEventListener('input', function() {
        const query = this.value.trim();
        clearTimeout(searchTimeout);
        if (query.length < 2) {
          searchSuggestions.classList.add('hidden');
          return;
        }
        searchTimeout = setTimeout(() => {
          fetch(`/api/search/suggestions?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
              if (data.suggestions && data.suggestions.length > 0) {
                searchSuggestions.innerHTML = data.suggestions.map(anime => `
                  <a href="/anime/${anime.slug}" class="flex items-center space-x-3 p-3 hover:bg-gray-800 border-b border-gray-800 last:border-b-0 transition-colors">
                    <img src="${anime.poster}" alt="${anime.title}" class="w-10 h-14 object-cover rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/40x56?text=N/A';">
                    <span class="text-sm font-medium text-gray-200">${anime.title}</span>
                  </a>`).join('');
                searchSuggestions.classList.remove('hidden');
              } else {
                searchSuggestions.classList.add('hidden');
              }
            })
            .catch(() => searchSuggestions.classList.add('hidden'));
        }, 300);
      });

      document.addEventListener('click', function(e) {
        if (!searchInput?.contains(e.target) && !searchSuggestions?.contains(e.target)) {
          searchSuggestions?.classList.add('hidden');
        }
      });

      // Cookie Consent Logic
      document.getElementById('acceptCookies')?.addEventListener('click', function() {
        fetch('/cookie-consent', { method: 'POST' })
          .then(() => document.getElementById('cookieConsent')?.style.display = 'none');
      });
      document.getElementById('declineCookies')?.addEventListener('click', function() {
        document.getElementById('cookieConsent')?.style.display = 'none';
      });

    block scripts