extends layout

block content
  div(class="animate-fade-in")
    //- Anime Hero Section
    section(class="relative h-[450px] md:h-[400px] bg-gray-900")
      //- Blurred Background Poster
      div(class="absolute inset-0 overflow-hidden")
        img(src=anime.poster alt=`${anime.title} background` class="w-full h-full object-cover scale-110 blur-2xl brightness-50" onerror="this.onerror=null;this.src='https://placehold.co/1920x400?text=';")

      //- Gradient Overlay
      div(class="absolute inset-0 bg-gradient-to-t from-gray-950 via-gray-950/70 to-transparent")

      //- Content
      div(class="container mx-auto px-4 sm:px-6 lg:px-8 relative h-full flex items-end pb-8")
        div(class="flex flex-col md:flex-row items-center md:items-end gap-6 md:gap-8")
          //- Poster
          div(class="flex-shrink-0 w-48 md:w-56 -mt-32 md:-mt-24")
            img(src=anime.poster alt=anime.title class="w-full h-auto object-cover rounded-xl shadow-2xl border-4 border-gray-800" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=Error';")

          //- Details
          div(class="text-center md:text-left")
            h1(class="text-3xl md:text-4xl font-extrabold text-white leading-tight")= anime.title
            if anime.genres && anime.genres.length > 0
              div(class="flex flex-wrap justify-center md:justify-start gap-2 mt-3")
                each genre in anime.genres.slice(0, 4)
                  a(href=`/genres/${genre.slug}` class="px-3 py-1 bg-gray-800/70 text-gray-300 text-xs font-medium rounded-full hover:bg-primary-600/50 hover:text-primary-200 transition-colors")= genre.name

    //- Main Content Area
    div(class="container mx-auto px-4 sm:px-6 lg:px-8 py-8")
      div(class="grid grid-cols-1 lg:grid-cols-12 gap-8")
        //- Left Column: Synopsis & Episodes
        div(class="lg:col-span-8 space-y-8")
          //- Synopsis
          div(class="bg-gray-900 p-6 rounded-xl border border-gray-800 animate-slide-up")
            h2(class="text-xl font-bold text-white mb-3") Sinopsis
            p(class="text-gray-400 leading-relaxed text-sm")= anime.synopsis || 'Sinopsis tidak tersedia.'

          //- Episode List
          if anime.episodes && anime.episodes.length > 0
            div(class="bg-gray-900 p-6 rounded-xl border border-gray-800 animate-slide-up" style="animation-delay: 100ms;")
              div(class="flex items-center justify-between mb-4")
                h2(class="text-xl font-bold text-white") Daftar Episode
                if anime.episodes.length > 24
                  a(href=`/anime/${anime.slug}/episodes` class="text-sm font-medium text-primary-400 hover:text-primary-300") Lihat Semua

              div(class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3")
                each ep in anime.episodes.slice(0, 25)
                  a(href=`/anime/${anime.slug}/episode/${ep.episode}` class="block p-3 bg-gray-800/50 rounded-lg text-center hover:bg-primary-900/40 border border-transparent hover:border-primary-700 transition-all duration-300")
                    span(class="font-semibold text-white") Episode #{ep.episode}
                    if ep.release_date
                      p(class="text-xs text-gray-500 mt-1")= ep.release_date

        //- Right Column: Details & Actions
        div(class="lg:col-span-4 space-y-6")
          //- Action Buttons
          div(class="grid grid-cols-1 gap-3 animate-slide-up" style="animation-delay: 150ms;")
            if anime.episodes && anime.episodes.length > 0
              a(href=`/anime/${anime.slug}/episode/${anime.episodes[0].episode}` class="w-full text-center px-4 py-3 bg-primary-600 text-white font-bold rounded-lg hover:bg-primary-700 transition-colors shadow-lg shadow-primary-900/30") Tonton Episode Terakhir
            if anime.batch_links && anime.batch_links.length > 0
              a(href=`/anime/${anime.slug}/batch` class="w-full text-center px-4 py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition-colors shadow-lg shadow-green-900/30") Download Batch

          //- Details Card
          div(class="bg-gray-900 p-6 rounded-xl border border-gray-800 space-y-3 text-sm animate-slide-up" style="animation-delay: 200ms;")
            h3(class="text-lg font-bold text-white mb-2") Informasi Detail
            div(class="flex justify-between"): span(class="text-gray-400") Status:
              span(class="font-medium text-white")= anime.status || 'N/A'
            div(class="flex justify-between"): span(class="text-gray-400") Tahun Rilis:
              span(class="font-medium text-white")= anime.release_year || 'N/A'
            if anime.rating
              div(class="flex justify-between items-center"): span(class="text-gray-400") Rating:
                div(class="flex items-center gap-1")
                  svg(class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"): path(d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z")
                  span(class="font-medium text-white")= anime.rating
            if anime.episodes
              div(class="flex justify-between"): span(class="text-gray-400") Total Episode:
                span(class="font-medium text-white")= anime.episodes.length

          //- Share Card
          div(class="bg-gray-900 p-6 rounded-xl border border-gray-800 animate-slide-up" style="animation-delay: 250ms;")
            h3(class="text-lg font-bold text-white mb-3") Bagikan
            div(class="flex space-x-2")
              button(onclick=`shareSocial('facebook')` class="w-full py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors") Facebook
              button(onclick=`shareSocial('twitter')` class="w-full py-2 bg-sky-500 text-white rounded-lg text-sm hover:bg-sky-600 transition-colors") Twitter
              button(onclick=`copyToClipboard()` class="w-full py-2 bg-gray-700 text-white rounded-lg text-sm hover:bg-gray-600 transition-colors") Copy Link

block scripts
  script.
    const animeTitle = !{JSON.stringify(anime.title)};
    const pageUrl = window.location.href;

    function shareSocial(platform) {
      const text = encodeURIComponent(`Nonton ${animeTitle} di KitaNime!`);
      let url = '';
      if (platform === 'facebook') {
        url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}&quote=${text}`;
      } else if (platform === 'twitter') {
        url = `https://twitter.com/intent/tweet?url=${encodeURIComponent(pageUrl)}&text=${text}`;
      }
      if (url) {
        window.open(url, '_blank', 'width=600,height=400');
      }
    }

    function copyToClipboard() {
      navigator.clipboard.writeText(pageUrl).then(() => {
        alert('Link berhasil disalin!');
      }).catch(err => {
        console.error('Gagal menyalin link: ', err);
        alert('Gagal menyalin link.');
      });
    }