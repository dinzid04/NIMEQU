extends layout

block content
  div(class="min-h-screen bg-gray-50 dark:bg-gray-900")
    div(class="container mx-auto px-4 py-6")
      div(class="grid grid-cols-1 lg:grid-cols-4 gap-8")
        div(class="lg:col-span-3 space-y-6")
          div(class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700")
            div(class="grid grid-cols-1 md:grid-cols-3")
              div(class="md:col-span-1")
                img(src=anime.poster alt=anime.title class="h-full w-full object-cover")
              div(class="md:col-span-2 p-6 lg:p-8")
                h1(class="text-3xl lg:text-4xl font-bold text-gray-900 dark:text-gray-100 mb-3 leading-tight")= anime.title

                div(class="flex flex-wrap items-center gap-x-4 gap-y-2 mb-5 text-sm")
                  if anime.status
                    span(class="inline-flex items-center px-3 py-1 rounded-full font-medium bg-primary-100 text-primary-800 dark:bg-primary-900/50 dark:text-primary-300")= anime.status
                  if anime.rating
                    div(class="flex items-center gap-1 text-gray-700 dark:text-gray-300")
                      svg(class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20")
                        path(d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z")
                      span(class="font-medium")= anime.rating
                  if anime.release_year
                    span(class="text-gray-500 dark:text-gray-400")= anime.release_year

                if anime.genres && anime.genres.length > 0
                  div(class="mb-5")
                    div(class="flex flex-wrap gap-2")
                      each genre in anime.genres
                        a(href=`/genres/${genre.slug}` class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs font-medium rounded-full hover:bg-primary-100 dark:hover:bg-primary-800 hover:text-primary-700 dark:hover:text-primary-300 transition-colors")= genre.name

                if anime.synopsis
                  div(class="mb-6")
                    h2(class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2") Sinopsis
                    p(class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed line-clamp-4")= anime.synopsis

                div(class="flex flex-wrap gap-4 items-center")
                  a(href=`/anime/${anime.slug}/episode/1` class="inline-flex items-center gap-2 bg-primary-600 text-white px-5 py-3 rounded-lg hover:bg-primary-700 transition-all duration-300 font-semibold transform hover:scale-105 shadow-lg")
                    svg(class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                      path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z")
                      path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
                    span Tonton Sekarang
                  if anime.batch_links && anime.batch_links.length > 0
                    a(href=`/anime/${anime.slug}/batch` class="inline-flex items-center gap-2 bg-green-600 text-white px-5 py-3 rounded-lg hover:bg-green-700 transition-all duration-300 font-semibold transform hover:scale-105 shadow-lg")
                      svg(class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4")
                      span Download Batch

          if anime.episodes && anime.episodes.length > 0
            div(class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 lg:p-8 border border-gray-200 dark:border-gray-700")
              h2(class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6") Daftar Episode
              div(class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4")
                each episode in anime.episodes
                  a(href=`/anime/${anime.slug}/episode/${episode.episode}` class="block bg-gray-50 dark:bg-gray-700/50 hover:bg-primary-50 dark:hover:bg-primary-900/50 border border-gray-200 dark:border-gray-700 hover:border-primary-300 dark:hover:border-primary-600 rounded-lg p-4 text-center transition-all duration-200 transform hover:scale-105")
                    span(class="text-sm font-semibold text-gray-800 dark:text-gray-200") Episode #{episode.episode}
                    if episode.release_date
                      span(class="block text-xs text-gray-500 dark:text-gray-400 mt-1")= episode.release_date
              if anime.episodes.length > 24
                div(class="mt-6 text-center")
                  a(href=`/anime/${anime.slug}/episodes` class="text-primary-600 dark:text-primary-400 hover:underline font-medium") Lihat Semua Episode (#{anime.episodes.length})

        div(class="lg:col-span-1 space-y-6")

          div(class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 space-y-3")
            h3(class="font-bold text-gray-900 dark:text-gray-100 mb-4") Informasi Anime
            div(class="space-y-3 text-sm")
              if anime.title
                div
                  span(class="font-medium text-gray-700 dark:text-gray-300") Judul:
                  span(class="text-gray-600 dark:text-gray-400 ml-2")= anime.title
              if anime.status
                div
                  span(class="font-medium text-gray-700 dark:text-gray-300") Status:
                  span(class="text-gray-600 dark:text-gray-400 ml-2")= anime.status
              if anime.release_year
                div
                  span(class="font-medium text-gray-700 dark:text-gray-300") Tahun:
                  span(class="text-gray-600 dark:text-gray-400 ml-2")= anime.release_year
              if anime.rating
                div
                  span(class="font-medium text-gray-700 dark:text-gray-300") Rating:
                  span(class="text-gray-600 dark:text-gray-400 ml-2")= anime.rating
              if anime.episodes && anime.episodes.length > 0
                div
                  span(class="font-medium text-gray-700 dark:text-gray-300") Total Episode:
                  span(class="text-gray-600 dark:text-gray-400 ml-2")= anime.episodes.length

          div(class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 space-y-3")
            h3(class="font-bold text-gray-900 dark:text-gray-100 mb-4") Bagikan Anime
            div(class="flex space-x-3")
              button(onclick=`shareToFacebook('${anime.title}')` class="flex-1 bg-blue-600 text-white py-2 px-3 rounded text-sm hover:bg-blue-700 transition-colors") Facebook
              button(onclick=`shareToTwitter('${anime.title}')` class="flex-1 bg-sky-500 text-white py-2 px-3 rounded text-sm hover:bg-sky-600 transition-colors") Twitter
              button(onclick="copyToClipboard()" class="flex-1 bg-gray-600 text-white py-2 px-3 rounded text-sm hover:bg-gray-700 transition-colors") Copy Link

          div(class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 space-y-3")
            h3(class="font-bold text-gray-900 dark:text-gray-100 mb-4") Anime Serupa
            div(class="text-sm text-gray-500 dark:text-gray-400 text-center py-4") Segera hadir...

block scripts
  script.
    function shareToFacebook(title) {
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent(`Nonton ${title} di KitaNime`);
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank', 'width=600,height=400');
    }

    function shareToTwitter(title) {
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent(`Nonton ${title} di KitaNime`);
      window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank', 'width=600,height=400');
    }

    function copyToClipboard() {
      navigator.clipboard.writeText(window.location.href).then(() => {
        alert('Link berhasil disalin!');
      }).catch(() => {
        const textArea = document.createElement('textarea');
        textArea.value = window.location.href;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('Link berhasil disalin!');
      });
    }

    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            if (img.dataset.src) {
              img.src = img.dataset.src;
              img.classList.remove('lazy');
              imageObserver.unobserve(img);
            }
          }
        });
      });

      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }
