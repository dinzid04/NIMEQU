extends ../layout

block content
  div(class="bg-gray-100 dark:bg-gray-800")
    div(class="container mx-auto px-4 py-8")
      header(class="mb-8 text-center")
        h1(class="text-4xl font-bold text-gray-900 dark:text-white mb-2") Cari Manhwa
        p(class="text-lg text-gray-600 dark:text-gray-400") Temukan manhwa, manhua, atau manga favoritmu.

      form(action="/manhwa/search" method="GET" class="max-w-2xl mx-auto mb-8")
        div(class="relative")
          input(type="text" name="q" value=query placeholder="Ketik judul manhwa..." class="w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary-500")
          button(type="submit" class="absolute right-0 top-0 h-full px-4 text-gray-500 hover:text-primary-600")
            svg(class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z")

      if results
        if results.length > 0
          div(id="manhwa-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4")
            each manhwa in results
              a(href=`/manhwa/detail/${manhwa.id}` class="group")
                div(class="relative")
                  img(src=manhwa.cover alt=manhwa.title class="w-full h-64 object-cover rounded-md shadow-lg transform transition-transform duration-300 group-hover:scale-105")
                  div(class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/70 to-transparent rounded-b-md")
                    h3(class="text-white font-semibold text-sm truncate")= manhwa.title
                    p(class="text-gray-300 text-xs")= manhwa.status

          div(id="loading-indicator" class="text-center py-8 hidden")
            p(class="text-gray-500 dark:text-gray-400") Memuat lebih banyak...
        else
          if query
            div(class="text-center py-16")
              h3(class="text-xl font-semibold") Tidak ada hasil
              p(class="text-gray-500 dark:text-gray-400 mt-2") Coba gunakan kata kunci yang berbeda.
          else
            div(class="text-center py-16")
              h3(class="text-xl font-semibold") Mulai Mencari
              p(class="text-gray-500 dark:text-gray-400 mt-2") Gunakan kolom pencarian di atas untuk menemukan manhwa.

block scripts
  script.
    document.addEventListener('DOMContentLoaded', function () {
      let currentPage = 1;
      let isLoading = false;
      const loadingIndicator = document.getElementById('loading-indicator');
      const manhwaGrid = document.getElementById('manhwa-grid');
      const query = !{JSON.stringify(query)};

      function loadMoreManhwa() {
        if (isLoading || !query) return;
        isLoading = true;
        currentPage++;
        loadingIndicator.classList.remove('hidden');

        fetch(`/manhwa/search?q=${query}&page=${currentPage}`)
          .then(response => response.json())
          .then(data => {
            if (data.results && data.results.length > 0) {
              data.results.forEach(manhwa => {
                const link = document.createElement('a');
                link.href = `/manhwa/detail/${manhwa.id}`;
                link.className = 'group';
                link.innerHTML = `
                  <div class="relative">
                    <img src="${manhwa.cover}" alt="${manhwa.title}" class="w-full h-64 object-cover rounded-md shadow-lg transform transition-transform duration-300 group-hover:scale-105">
                    <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/70 to-transparent rounded-b-md">
                      <h3 class="text-white font-semibold text-sm truncate">${manhwa.title}</h3>
                      <p class="text-gray-300 text-xs">${manhwa.status}</p>
                    </div>
                  </div>
                `;
                manhwaGrid.appendChild(link);
              });
            } else {
              // No more pages
              window.removeEventListener('scroll', handleScroll);
            }
          })
          .catch(error => console.error('Error fetching more manhwa:', error))
          .finally(() => {
            isLoading = false;
            loadingIndicator.classList.add('hidden');
          });
      }

      function handleScroll() {
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200) {
          loadMoreManhwa();
        }
      }

      window.addEventListener('scroll', handleScroll);
    });